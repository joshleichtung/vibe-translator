# Story 1.3: Set Up ESLint and Validation Gates

## Status
Draft

## Story
**As a** developer,
**I want** ESLint configured with TypeScript rules and pre-commit hooks,
**so that** code quality is maintained automatically before commits.

## Acceptance Criteria
1. ESLint installed with TypeScript plugin
2. ESLint config includes recommended TypeScript rules
3. `npm run lint` script added and passes
4. Husky installed for Git hooks
5. Pre-commit hook runs `typecheck && lint` (must pass to commit)
6. Hook execution time <5 seconds for developer ergonomics

## Tasks / Subtasks
- [ ] Install ESLint with TypeScript support (AC: 1)
  - [ ] Install ESLint v9.0.0+
  - [ ] Install TypeScript ESLint parser and plugin
  - [ ] Verify ESLint CLI works: `npx eslint --version`
- [ ] Configure ESLint rules (AC: 2)
  - [ ] Create `eslint.config.js` with TypeScript-aware rules
  - [ ] Enable recommended TypeScript rules
  - [ ] Configure React hooks rules
  - [ ] Add unused variable warnings
  - [ ] Test configuration with sample file
- [ ] Add lint script to package.json (AC: 3)
  - [ ] Add `"lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0"`
  - [ ] Add `"lint:fix": "eslint . --ext ts,tsx --fix"`
  - [ ] Run `npm run lint` and verify passes
  - [ ] Test `npm run lint:fix` auto-fixes issues
- [ ] Install and configure Husky (AC: 4)
  - [ ] Install Husky v9.0.0+
  - [ ] Initialize Husky: `npx husky init`
  - [ ] Verify `.husky/` directory created
- [ ] Set up pre-commit hook (AC: 5)
  - [ ] Create `.husky/pre-commit` hook
  - [ ] Add commands: `npm run typecheck && npm run lint`
  - [ ] Make hook executable: `chmod +x .husky/pre-commit`
  - [ ] Test hook blocks commit on lint failure
  - [ ] Test hook allows commit on success
- [ ] Optimize hook performance (AC: 6)
  - [ ] Time hook execution: should be <5 seconds
  - [ ] If slow, consider lint-staged for partial file checking
  - [ ] Document expected execution time in README

## Dev Notes

### ESLint Configuration
From ui-architecture.md:
- **Version**: ESLint v9.0.0+ (flat config format)
- **TypeScript-aware**: Must use @typescript-eslint parser
- **React-aware**: Must include React hooks rules

### ESLint Config Template
```javascript
// eslint.config.js
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'

export default tseslint.config(
  { ignores: ['dist'] },
  {
    extends: [js.configs.recommended, ...tseslint.configs.recommended],
    files: ['**/*.{ts,tsx}'],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
    plugins: {
      'react-hooks': reactHooks,
      'react-refresh': reactRefresh,
    },
    rules: {
      ...reactHooks.configs.recommended.rules,
      'react-refresh/only-export-components': [
        'warn',
        { allowConstantExport: true },
      ],
      '@typescript-eslint/no-unused-vars': ['warn', { argsIgnorePattern: '^_' }],
      '@typescript-eslint/no-explicit-any': 'error',
    },
  },
)
```

### npm Scripts to Add
```json
{
  "scripts": {
    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "lint:fix": "eslint . --ext ts,tsx --fix"
  }
}
```

### Husky Pre-Commit Hook
```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Run TypeScript validation
npm run typecheck

# Run ESLint validation
npm run lint
```

### Dependencies to Install
```bash
npm install -D eslint@^9.0.0 \
  @eslint/js \
  globals \
  eslint-plugin-react-hooks \
  eslint-plugin-react-refresh \
  typescript-eslint

npm install -D husky@^9.0.0
```

### Git Workflow Integration
From prd.md:
- **Pre-Commit Validation Gate**: typecheck + lint must pass
- **Fast Execution**: <5 seconds to avoid developer friction
- **Progressive Commits**: Frequent commits with validated quality

### Performance Considerations
If hook execution exceeds 5 seconds:
1. Consider `lint-staged` for partial file linting
2. Use incremental TypeScript checking
3. Document performance in README

### Testing the Hooks
1. **Intentional Failure Test**:
   - Add `const unused: any = 5` to test file
   - Try to commit
   - Should fail with ESLint error

2. **Success Test**:
   - Fix the error
   - Commit should succeed

3. **Bypass Test**:
   - Verify `git commit --no-verify` works for emergencies

### Common ESLint Rules for Audio/Music App
- No `any` types (critical for music theory types)
- Warn on unused variables
- Enforce React hooks rules
- Prefer const over let
- No console.log in production builds (warn only)

## Testing
Validation through:
1. `npm run lint` passes with zero errors
2. `npm run lint:fix` auto-fixes formatting issues
3. Pre-commit hook blocks commits with lint errors
4. Pre-commit hook allows commits with clean code
5. Hook execution time measured and <5 seconds

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-25 | 0.1 | Initial story creation from PRD Epic 1 | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_
